<html>

<head></head>

<body style="font-family:tahoma;">
	<style>
		#createbutton {
			width: 150px;
			height: 15px;
			background-color: #efefef;
			text-align: center;
			padding: 10px;
			cursor: pointer;
			margin-bottom: 5px;
			margin-top: 5px;
		}
	</style>
	<input type="text" placeholder="nick" id="nick" value="Keke">
	<input type="text" placeholder="renk" id="renk" value="red">
	<div>
		<div style="float:left" onclick="createControllablePlayer()" id="createbutton">Oyuncu Olu≈ütur</div>
		<div style="float:left;margin-left:10px" id="msg">engine on/off: press E</div>
	</div>
	<div style="clear:both"></div>

	<div id="game" style="border:1px dotted #000;"></div>

	<script type="text/javascript" src="https://rawgithub.com/craftyjs/Crafty/release/dist/crafty-min.js"></script>
	<script type="text/javascript" src="./components.js"></script>
	<script type="text/javascript" src="./socket.io.js"></script>
	<script>
		var socket = io('http://192.168.6.80:3000');

		var players = {};

		var boardWidth = 1024;
		var boardHeight = 768;

		Crafty.init(boardWidth, boardHeight, document.getElementById('game'));

		function createControllablePlayer() {
			var playerColor = document.getElementById("renk").value;
			var playerNick = document.getElementById("nick").value;

			var player = createMyPlayer(playerNick, playerColor);

			socket.emit("createPlayerOnServer", {
				nick: playerNick,
				color: playerColor,
				id: player._playerId,
				x: player.x,
				y: player.y
			});

			
		}

		socket.on("newPlayerJoined", function (newPlayerInfo) {
			console.log("new-player-joined");
			createOtherPlayer(newPlayerInfo.id, newPlayerInfo.nick, newPlayerInfo.color);
		});

		function createMyPlayer(nick, color) {

			var player = Crafty.e("MyPlayer")
				.setName(nick)
				.showName()
				.color(color)
				.addWeapon('rifle')
				.place(0, 0)
				.bindSocket(socket);

			players[player._playerId] = player;

			return player;
		}

		function createOtherPlayer(id, nick, color) {

			var player = Crafty.e("OtherPlayer")
				.setId(id)
				.setName(nick)
				.showName()
				.color(color)
				.addWeapon('rifle')
				.place(0, 0)
				.bindSocket(socket);

			players[player._playerId] = player;

			return player;
		}
	</script>
</body>

</html>